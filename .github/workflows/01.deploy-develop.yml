name: 01.deploy-develop

on:
  workflow_dispatch:
    inputs:
      confirmDeployment:
        description: 'Confirm Deployment'
        required: true
env:
  SERVER_IP: "20.249.210.27"
  SERVER_USER: "outerxspace"
  IMAGE: be-app
  USERNAME_DOCKER_HUB: warjamma

permissions:
  id-token: write
  contents: write
  issues: write
jobs: 
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Log in to Azure
        uses: azure/login@v1
        with:
            creds: ${{ secrets.AZURE_CREDENTIALS }}
            allow-no-subscriptions: true

      - name: Azure CLI script
        uses: azure/CLI@v1
        env:
          AZURE_CORE_OUTPUT: none
        with:
          azcliversion: latest
          inlineScript: |
            az account show
      - name: Deploy
        run: |
            sudo docker kill \"$IMAGE\"
            sudo docker rm \"$IMAGE\"
            sudo docker pull $USERNAME_DOCKER_HUB/$IMAGE:latest
            sudo docker run -d -p 3000:80 --name \"$IMAGE\" $USERNAME_DOCKER_HUB/$IMAGE:latest